<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>爱心~</title>
<style>
  html,body{
    height:100%;margin:0;overflow:hidden;
    font-family:"微软雅黑",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    background:
      radial-gradient(1200px 600px at 50% 45%, rgba(255,255,255,.65), rgba(255,255,255,0) 60%),
      radial-gradient(circle at 50% 45%, #fff4f7 0%, #c9eaff 100%);
  }
  .stage{position:relative;width:100%;height:100%;}
  .msg{
    position:absolute;left:50%;top:50%;
    padding:10px 16px;border-radius:16px;
    color:#fff;font-weight:700;
    font-size:clamp(14px,3vmin,22px);
    text-shadow:0 2px 8px rgba(0,0,0,.28);
    opacity:0;
    transform:
      translate(-50%,-50%) translate(var(--dx),var(--dy)) scale(.75) rotate(var(--rot));
    animation: flight var(--dur) cubic-bezier(.25,.7,.3,1) var(--delay) both;
    box-shadow:0 8px 26px rgba(0,0,0,.22);
    will-change: transform, opacity;
    background: var(--bg);
  }

  /* 第一阶段：散开→回收→定型为心（停住不消失） */
  @keyframes flight{
    0%{
      opacity:0;
      transform:translate(-50%,-50%) translate(var(--dx),var(--dy)) scale(.75) rotate(var(--rot));
    }
    18%{ opacity:1; }
    45%{
      transform:translate(-50%,-50%) translate(calc(var(--dx)*.2),calc(var(--dy)*.2)) scale(1.06);
    }
    70%{
      transform:translate(-50%,-50%) translate(calc(var(--dx)*1.15),calc(var(--dy)*1.15)) scale(.95) rotate(var(--rot));
    }
    88%{
      transform:translate(-50%,-50%) translate(calc(var(--heart-x)*.6),calc(var(--heart-y)*.6)) scale(.9) rotate(var(--heart-rot));
    }
    100%{
      opacity:1;
      transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1) rotate(var(--heart-rot));
    }
  }

  /* 文字淡出→心瓣显形（用两个半圆） */
  .msg::before,.msg::after{
    content:'';
    position:absolute;left:50%;top:0;
    background:inherit;border-radius:50px 50px 0 0;
    width:22px;height:34px;opacity:0;transition:opacity .28s ease;
    transform-origin:0 100%;transform:rotate(-45deg);
  }
  .msg::after{ left:0;transform-origin:100% 100%;transform:rotate(45deg); }
  .msg.heart-mode{ color:transparent; text-shadow:none; }
  .msg.heart-mode::before,.msg.heart-mode::after{ opacity:1; }

  /* 定型后：轻微“呼吸”2秒（随后触发二次爆炸） */
  .msg.locked{
    animation:none; /* 停止flight，固定位置 */
    transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1) rotate(var(--heart-rot));
    opacity:1;
  }
  .msg.locked.pulse{
    animation:pulse 2.2s ease-in-out 1; /* 只跳动一次，为爆炸前蓄势 */
  }
  @keyframes pulse{
    0%,100%{ transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1); }
    50%   { transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1.08); }
  }

  /* 第二阶段：最终爆炸（从心形位置向外飞散并淡出） */
  .msg.burst{
    animation: burst 1.4s cubic-bezier(.17,.6,.2,1) forwards;
  }
  @keyframes burst{
    0%{
      opacity:1;
      transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1);
      filter:blur(0);
    }
    70%{
      opacity:.9;
      transform:
        translate(-50%,-50%)
        translate(calc(var(--heart-x) + var(--bx)*0.7), calc(var(--heart-y) + var(--by)*0.7))
        scale(.9) rotate(var(--rot));
      filter:blur(.3px);
    }
    100%{
      opacity:0;
      transform:
        translate(-50%,-50%)
        translate(calc(var(--heart-x) + var(--bx)), calc(var(--heart-y) + var(--by)))
        scale(.7) rotate(var(--rot));
      filter:blur(1px);
    }
  }

  .center-title{
    position:absolute;left:50%;top:50%;
    transform:translate(-50%,-50%);
    font-weight:800;letter-spacing:.12em;
    font-size:clamp(18px,4vmin,28px);
    color:rgba(255,105,180,.6);
    text-shadow:0 2px 10px rgba(255,105,180,.15);
    opacity:.0; pointer-events:none;
    animation:titleIn 1.2s ease 0.8s both;
  }
  @keyframes titleIn{
    from{opacity:0; transform:translate(-50%,-55%);}
    to  {opacity:.95; transform:translate(-50%,-50%);}
  }

  .replay{
    position:absolute;right:18px;bottom:18px;
    padding:10px 14px;border:none;border-radius:10px;
    background:rgba(255,255,255,.5);
    backdrop-filter:blur(8px);
    color:#222;font-weight:600;cursor:pointer;
    box-shadow:0 5px 20px rgba(0,0,0,.22);
  }
</style>
</head>
<body>
  <div class="stage" id="stage">
    <div class="center-title" id="title"> I love you ♥</div>
  </div>
  <button class="replay" id="replay">重放</button>

<script>
/* —— 写你喜欢的 —— */
const tips=[
 '好好吃饭','天天开心','少生气','多吃饭','不要减肥',
   '吹牛逼呢','记得想爸爸','爱你','小狗蛋吧','有你真好',
   '少吃洋芋涨憨掉','一顿吃两碗','有事就说出来','少点争执',
   '想陪你看星星','今夜的梦给你','偏爱你','你是人间四月天',
   '拥抱要紧一点','想你成习惯了','一瞬也是永恒','么么哒','小狗日记',
   'May I love you','约会在晴天','期待明天见','比如你和我','希望片刻变永久',
   '想和你看海','此刻的风想你','遇见你后时间变慢','偷偷折个角不能翻篇',
   '想靠近你一点','顾玉兰大傻逼','心软是因为你','想牵你的手看日落',
   '幸福放慢倍数','心跳藏不住','有你世界亮一点','小小幸福的'
];

const stage  = document.getElementById('stage');
const replay = document.getElementById('replay');
const title  = document.getElementById('title');

/* 外抛方向（初始“炸开”用） */
const directions = [
  {dx:'0vw',dy:'-80vh'},{dx:'0vw',dy:'80vh'},
  {dx:'-80vw',dy:'0vh'},{dx:'80vw',dy:'0vh'},
  {dx:'-70vw',dy:'-70vh'},{dx:'70vw',dy:'-70vh'},
  {dx:'-70vw',dy:'70vh'},{dx:'70vw',dy:'70vh'},
  {dx:'0vw',dy:'-60vh'},{dx:'0vw',dy:'60vh'},
  {dx:'-60vw',dy:'0vh'},{dx:'60vw',dy:'0vh'}
];

function rand(min,max){return Math.random()*(max-min)+min;}
function randomGradient(){
  const arr=[
    ['#ff758c','#ff7eb3'], ['#a18cd1','#fbc2eb'],
    ['#f6d365','#fda085'], ['#84fab0','#8fd3f4'],
    ['#f093fb','#f5576c'], ['#4facfe','#00f2fe'],
    ['#43e97b','#38f9d7'], ['#fa709a','#fee140'],
    ['#30cfd0','#330867'], ['#5ee7df','#b490ca']
  ];
  const [c1,c2]=arr[Math.floor(Math.random()*arr.length)];
  return `linear-gradient(135deg,${c1},${c2})`;
}

/* 心形参数方程（最终定型位置） */
function heartXY(t){
  const s = 16; // 爱心尺寸：12~22 可调
  const x = s * (16 * Math.sin(t)**3);
  const y = -s * (13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t));
  return {x: x+'px', y: y+'px'};
}

function createMsg(i,total){
  const el = document.createElement('div');
  el.className = 'msg';

  const d = directions[Math.floor(Math.random()*directions.length)];
  el.style.setProperty('--dx', d.dx);
  el.style.setProperty('--dy', d.dy);
  el.style.setProperty('--rot', rand(-55,55)+'deg');
  el.style.setProperty('--dur', (rand(6.8,8.6))+'s');
  el.style.setProperty('--delay', (i*0.11 + rand(0,0.35))+'s');
  el.style.setProperty('--bg', randomGradient());

  // 均匀映射到 0~2π 的心形路径
  const t = (i / total) * Math.PI * 2;
  const {x,y} = heartXY(t);
  el.style.setProperty('--heart-x', x);
  el.style.setProperty('--heart-y', y);
  el.style.setProperty('--heart-rot', rand(-18,18)+'deg');

  // 文本容器
  const span = document.createElement('span');
  span.className = 'text';
  span.textContent = tips[Math.floor(Math.random()*tips.length)];
  el.appendChild(span);

  // 回收前切心瓣
  const delay = parseFloat(el.style.getPropertyValue('--delay'));
  const dur   = parseFloat(el.style.getPropertyValue('--dur'));
  const switchAt = delay + dur * 0.86;
  const switchTimer = setTimeout(()=>{ el.classList.add('heart-mode'); }, switchAt*1000);

  // flight 完成：定型并做一次心跳
  el.addEventListener('animationend',()=>{
    clearTimeout(switchTimer);
    el.classList.add('heart-mode','locked','pulse');

    // 为“最终爆炸”预先计算飞散向量（基于心形中心向四周）
    const spread = rand(140, 260);     // 爆散距离(px)
    const ang    = rand(0, Math.PI*2); // 方向
    const bx = Math.cos(ang)*spread;
    const by = Math.sin(ang)*spread;
    el.style.setProperty('--bx', bx+'px');
    el.style.setProperty('--by', by+'px');
  }, {once:true});

  stage.appendChild(el);
}

/* 触发最终爆炸 */
function finalBurst(){
  stage.querySelectorAll('.msg.locked').forEach(el=>{
    el.classList.remove('pulse');
    // 统一稍许随机延迟，让爆炸有层次
    const jitter = rand(0, 200); // 0~200ms
    setTimeout(()=> el.classList.add('burst'), jitter);
    // 清理 DOM
    el.addEventListener('animationend',()=> el.remove(), {once:true});
  });
}

/* 播放全流程 */
function play(){
  // 清空
  stage.querySelectorAll('.msg').forEach(n=>n.remove());
  title.style.opacity = 0;

  const TOTAL = 220; // 200~280 都行
  for(let i=0;i<TOTAL;i++) createMsg(i,TOTAL);

  // 中心字样淡入
  setTimeout(()=>{ title.style.opacity = 1; }, 1400);

  // 等所有粒子都“定型心形”并心跳完，再统一爆炸
  // 估算：最长 flight ≈ 8.6s + 最大延迟 ≈ 0.35 + 额外余量 0.3s，再等心跳 2.2s
  const TOTAL_TIME_MS = (8.6 + 0.35 + 0.3 + 2.2) * 1000;
  setTimeout(finalBurst, TOTAL_TIME_MS);
}

play();
replay.onclick = play;
</script>
</body>
</html>
